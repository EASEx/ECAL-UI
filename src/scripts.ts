export const COLAB_SCRIPT = "var ecalLogger={log:e=>{var t=new Date;console.log(`[ECAL] : ${t.toTimeString()} : `+e)},warn:e=>{var t=new Date;console.warn(`[ECAL] : ${t.toTimeString()} : ${e}]`)}},logNotebookCells=()=>{var e=document.querySelectorAll(\".cell.code\"),r=[];return e.length&&(console.log(`We have ${e.length} nodes.`),e.forEach((e,t)=>{var n=1==e.getElementsByTagName(\"colab-run-button\").length?e.getElementsByTagName(\"colab-run-button\")[0]:void 0,o=1==e.getElementsByClassName(\"inputarea horizontal layout code\").length?e.getElementsByClassName(\"inputarea horizontal layout code\")[0]:void 0;o&&n&&r.push({index:t,input:o.innerText.trim()||\"\",output:e.innerText.replace(o.innerText,\"\").trim()||\"\",isExecuted:!!n.executionCount,info:n.getInfo()||{status:\"\",timestamp:0,user_tz:0,elapsed:0,user:{displayName:\"\",photoUrl:\"\",userId:\"\"},execution_count:0},hasError:n.hasError||e.innerText.replace(o.innerText,\"\").trim().toLowerCase().includes(\"error\")||e.innerText.replace(o.innerText,\"\").trim().toLowerCase().includes(\"traceback\"),busy:n.busy||!1})})),r},listLoadedModules=()=>{for(var e={numpy:!1,pandas:!1,matplotlib:!1},t=document.getElementsByClassName(\"inputarea horizontal layout code\"),n=0;n<t.length;n++){var o,r=t[n].innerText;for(o in e)Object.prototype.hasOwnProperty.call(e,o)&&r.includes(o)&&(e[o]=!0)}return e};window.colabListeners||(document.addEventListener(\"keyup\",()=>{window.lastkeypressTime=Math.round(Date.now()/1e3)}),document.addEventListener(\"mousemove\",function(e){window.lastmousemoveTime=Math.round(Date.now()/1e3)}),window.colabListeners=!0,ecalLogger.log(\"All listeners ready!\"));"

export const EVENT_SCRIPT = "async function postData(e=\"\",o={}){const t=await fetch(e,{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},redirect:\"follow\",body:JSON.stringify(o)});return t.json()}void 0===window.sseSource&&(window.mouseTrail=[],window.test_id=\"%TEST_ID%\",window.client_id=\"%CLIENT_ID%\",window.server_url=\"%SERVER_URL%\",window.lastkeypressTime=Math.round(Date.now()/1e3),window.lastmousemoveTime=Math.round(Date.now()/1e3),window.sseSource=new EventSource(`${window.server_url}/sse?id=${window.client_id}&test_id=`+window.test_id),window.sseSource.addEventListener(\"jupyter_ping_\"+test_id,e=>{var o,t,n;window.document.URL.toString().includes(\"colab.research.google\")?(o=logNotebookCells(),listLoadedModules(),t=window.lastkeypressTime||Math.round(Date.now()/1e3),n=window.lastmousemoveTime||Math.round(Date.now()/1e3),console.log(\"received event askData\"),new Date,(!window.lastDataCall||20<Math.round(Date.now()/1e3)-window.lastDataCall)&&(window.lastDataCall=Math.round(Date.now()/1e3),postData(`http://localhost:8080/metrics?id=${window.client_id}&test_id=`+window.test_id,{celldata:o,lastmousemoveTime:n,lastkeypressTime:t,windowURL:window.document.URL,timestamp:Math.round(Date.now()/1e3)}))):ecalLogger.warn(\"ECAL trying to read data from non Jupyter page. Ignoring!\")}),window.sseSource.addEventListener(\"trigger\",e=>{console.log(e.data),window.ipcAPI.invoke.sendAction(e.data.toString())}));"

export const FETCH_SCRIPT = "runButtons=document.getElementsByTagName(\"colab-run-button\")||[],runButtons.length<2?(ecalLogger.warn(\"Unable to find fetch button! Document appears to be modified\"),window.ipcAPI.invoke.sendWarning(\"Unable to find fetch button! Document appears to be modified\")):runButtons[1].click();"